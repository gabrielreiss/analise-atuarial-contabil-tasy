SELECT
TO_CHAR(T1.DT_MOVIMENTO, 'YYYY-MM') AS COMPETENCIA,
T1.CD_CONTA_DEBITO,
T7.DS_CONTA_CONTABIL,
T1.CD_HISTORICO,
T2.DS_HISTORICO,
SUM(T1.VL_MOVIMENTO) Total

FROM tasy.CTB_MOVIMENTO T1

JOIN Tasy.HISTORICO_PADRAO T2 ON T1.CD_HISTORICO = T2.CD_HISTORICO
--JOIN tasy.CTB_CLASSIF_MOVIMENTO T3 ON T1.NR_SEQ_CLASSIF_MOVTO = T3.NR_SEQUENCIA
JOIN tasy.CTB_MES_REF T4 ON T1.NR_SEQ_MES_REF = T4.NR_SEQUENCIA
LEFT JOIN tasy.CTB_MOVIMENTO T5 ON T1.NR_SEQ_MOVTO_PARTIDA = T5.NR_SEQUENCIA
LEFT JOIN tasy.LOTE_CONTABIL T6 ON T1.NR_LOTE_CONTABIL = T6.NR_LOTE_CONTABIL
LEFT JOIN tasy.CONTA_CONTABIL T7 ON T1.CD_CONTA_DEBITO = T7.CD_CONTA_CONTABIL

WHERE
T1.CD_CONTA_DEBITO IN ('44751', '40019', '44752', '44753', '44754', '40072', '44755', '44756', '44064', '44065', '44076', '46151')
--(T1.CD_CONTA_DEBITO IN (44065, 44064, 40019, 40072) OR T1.CD_CONTA_CREDITO IN (44065, 44064, 40019, 40072))
AND (T1.DT_MOVIMENTO >= TRUNC(SYSDATE, 'YEAR') AND T1.DT_MOVIMENTO < ADD_MONTHS(TRUNC(SYSDATE, 'YEAR'), 12))
--AND NR_SEQ_MES_REF >= 1565
AND T1.CD_HISTORICO IN (1083, 1029)
AND T4.DT_BLOQUEIO IS NOT NULL

GROUP BY 
TO_CHAR(T1.DT_MOVIMENTO, 'YYYY-MM'),
T1.CD_CONTA_DEBITO,
T7.DS_CONTA_CONTABIL,
T1.CD_HISTORICO,
T2.DS_HISTORICO

ORDER BY 
TO_CHAR(T1.DT_MOVIMENTO, 'YYYY-MM'),
T1.CD_CONTA_DEBITO,
T7.DS_CONTA_CONTABIL,
T1.CD_HISTORICO,
T2.DS_HISTORICO