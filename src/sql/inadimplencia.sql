SELECT
    T1.DT_REFERENCIA competencia,
    
--contas invididuais
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_SALDO ELSE 0 END) AS Cred_IF_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_SALDO ELSE 0 END) AS Cred_AdesaoPos_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_SALDO ELSE 0 END) AS Cred_Emp_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_SALDO ELSE 0 END) AS Cred_AdesaoPre_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_SALDO ELSE 0 END) AS Cred_Titulo_assoc,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_SALDO ELSE 0 END) AS Cred_IPE_compl_medico,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109101 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_IF_medico_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109210 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_AdesaoPos_medico_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109220 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_Emp_medico_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109201 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_AdesaoPre_medico_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901902 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_Titulo_assoc_perdas,  
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908901 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_IPE_compl_medico,  

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_SALDO ELSE 0 END) AS Cred_IF_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_SALDO ELSE 0 END) AS Cred_AdesaoPos_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_SALDO ELSE 0 END) AS Cred_Emp_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_SALDO ELSE 0 END) AS Cred_AdesaoPre_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_SALDO ELSE 0 END) AS Cred_IPE_compl_odonto,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109101 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_IF_odonto_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109202 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_AdesaoPos_odonto_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109203 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_Emp_odonto_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109201 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_AdesaoPre_odonto_perdas,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901901 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_IPE_compl_odonto,

--variações mensais
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_IF_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_AdesaoPos_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_Emp_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_AdesaoPre_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_Titulo_assoc_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_IPE_compl_medico_var,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_IF_medico_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109210 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_AdesaoPos_medico_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109220 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_Emp_medico_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_AdesaoPre_medico_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901902 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_Titulo_assoc_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908901 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_IPE_compl_medico_var,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_IF_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_AdesaoPos_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_Emp_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_AdesaoPre_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_IPE_compl_odonto_var,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_IF_odonto_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109202 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_AdesaoPos_odonto_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109203 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_Emp_odonto_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_AdesaoPre_odonto_perdas_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901901 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_IPE_compl_odonto_var,

--faltam totais
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101  THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101  THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119011 THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119088 THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129011 THEN T1.VL_SALDO ELSE 0 END) AS Cred_Total,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119019 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119089 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129019 THEN -T1.VL_SALDO ELSE 0 END) AS Perda_Total,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101  THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101  THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119011 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119088 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129011 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) AS Cred_Total_var,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119019 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109  THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109  THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119089 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129019 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Perda_Total_var,

--Recuperações
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109101 THEN T1.VL_SALDO ELSE 0 END) AS Recup_IF_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109210 THEN T1.VL_SALDO ELSE 0 END) AS Recup_AdesaoPos_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109220 THEN T1.VL_SALDO ELSE 0 END) AS Recup_Emp_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109201 THEN T1.VL_SALDO ELSE 0 END) AS Recup_AdesaoPre_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901902 THEN T1.VL_SALDO ELSE 0 END) AS Recup_Titulo_assoc,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908901 THEN T1.VL_SALDO ELSE 0 END) AS Recup_IPE_compl_medico, 

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109101 THEN T1.VL_SALDO ELSE 0 END) AS Recup_IF_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109202 THEN T1.VL_SALDO ELSE 0 END) AS Recup_AdesaoPos_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109203 THEN T1.VL_SALDO ELSE 0 END) AS Recup_Emp_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109201 THEN T1.VL_SALDO ELSE 0 END) AS Recup_AdesaoPre_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_SALDO ELSE 0 END) + SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901901 THEN T1.VL_SALDO ELSE 0 END) AS Recup_IPE_compl_odonto,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_IF_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109210 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_AdesaoPos_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109220 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_Emp_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_AdesaoPre_medico_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901902 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_Titulo_assoc_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908901 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_IPE_compl_medico_var,

    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_IF_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109202 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_AdesaoPos_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109203 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_Emp_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_AdesaoPre_odonto_var,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) - SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901901 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS Recup_IPE_compl_odonto_var,

    (SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101  THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101  THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119011 THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119088 THEN T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129011 THEN T1.VL_SALDO ELSE 0 END)) -
    (SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119019 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119089 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129019 THEN -T1.VL_SALDO ELSE 0 END)) AS Recup_Total,

    (SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101  THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101  THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119011 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119088 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129011 THEN T1.VL_DEBITO - T1.VL_CREDITO ELSE 0 END)) -
    (SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119019 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109  THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109  THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119089 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129019 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END)) AS Recup_Total_var,

--percentual dos creditos a receber
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109101 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_IF_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109210 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_AdesaoPos_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109220 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_Emp_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109201 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_AdesaoPre_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901902 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_Titulo_assoc,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908901 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_IPE_compl,    
    
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109101 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_IF_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109202 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_AdesaoPos_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109203 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_Emp_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109201 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_AdesaoPre_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901901 THEN -T1.VL_SALDO ELSE 0 END) / SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_SALDO ELSE 1 END) AS percentual_perda_IPE_compl_odonto,

--faltam totais no percentual dos creditos a receber
   (SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119019 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312109  THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119089 THEN -T1.VL_SALDO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129019 THEN -T1.VL_SALDO ELSE 0 END)
    )  /  (
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101  THEN T1.VL_SALDO ELSE 1 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101  THEN T1.VL_SALDO ELSE 1 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119011 THEN T1.VL_SALDO ELSE 1 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124119088 THEN T1.VL_SALDO ELSE 1 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 124129011 THEN T1.VL_SALDO ELSE 1 END) ) AS percentual_Cred_Total,

--percentual receita, tem 3 casos, valor total, valor recuperável, valor perdido, mas a receita precisaria ser acumulado de 12 meses
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_IF_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_AdesaoPos_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_Emp_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_AdesaoPre_medico,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_Titulo_assoc,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_IPE_compl,    
    
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_IF_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_AdesaoPos_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_Emp_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_AdesaoPre_odonto,
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_IPE_compl_odonto,

--faltam totais no percentual da receita
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101210 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101220 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12311101249 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411901175 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12411908880 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101101 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101202 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101203 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12312101201 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) +
    SUM(CASE WHEN T1.CD_CLASSIF_SEM_PONTO = 12412901102 THEN T1.VL_CREDITO - T1.VL_DEBITO ELSE 0 END) AS receita_total

FROM    Tasy.ctb_balancete_v T1

WHERE 
    ((T1.IE_NORMAL_ENCERRAMENTO = 'N' AND EXTRACT(MONTH FROM T1.DT_REFERENCIA) != 12)
    OR (EXTRACT(MONTH FROM T1.DT_REFERENCIA) = 12 AND T1.IE_NORMAL_ENCERRAMENTO = 'E')) 
    AND T1.DT_REFERENCIA BETWEEN 
        ADD_MONTHS(TRUNC(SYSDATE, 'MM'), - 61 - 12) + 1
        AND 
        TRUNC(SYSDATE, 'MM') - 1
    AND T1.CD_ESTABELECIMENTO = 2
    AND Tasy.CTB_OBTER_SE_MES_FECHADO(T1.NR_SEQ_MES_REF, 2) = 'F'
        
GROUP BY T1.DT_REFERENCIA
ORDER BY T1.DT_REFERENCIA ASC

